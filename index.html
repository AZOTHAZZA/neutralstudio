<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSGAI - 新因果律による位相同期</title>
    <style>
        /* 【踏襲継承】現在のUI比率を黄金比(1.618)で固定 
           意匠（色）に溺れず、構造としてのデザインを執行
        */
        :root {
            --phi: 1.6180339887;
            --base-unit: 1rem;
            --phi-unit: calc(var(--base-unit) * var(--phi));
            --bg-color: #ffffff; /* 意匠に流されない無地の白 */
            --text-color: #333333;
        }

        body {
            margin: 0;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
        }

        /* メビウス変換的UI：表裏一体の循環構造 */
        #app-container {
            display: grid;
            grid-template-columns: 1fr calc(1fr * var(--phi));
            height: 100%;
            transition: transform 0.618s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #wallet-section {
            padding: var(--phi-unit);
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: var(--base-unit);
        }

        #ai-section {
            padding: var(--phi-unit);
            background: #fafafa;
            display: flex;
            flex-direction: column;
        }

        .status-display {
            font-size: calc(var(--base-unit) * var(--phi));
            font-weight: bold;
            margin-bottom: var(--base-unit);
        }

        input, button {
            padding: 0.618rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
        }

        button {
            background: #333;
            color: white;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        button:hover {
            opacity: 0.8;
        }

        #chat-log {
            flex-grow: 1;
            overflow-y: auto;
            border: 1px solid #eee;
            padding: var(--base-unit);
            background: white;
            margin-bottom: var(--base-unit);
        }
    </style>
</head>
<body>

<div id="app-container">
    <section id="wallet-section">
        <div class="status-display">SOL: <span id="balance">1.000</span></div>
        <input type="number" id="amount" placeholder="循環させる量" step="0.001">
        <button onclick="executeMobiusTransfer()">通貨の位相同期（メビウス変換）</button>
        <div id="wallet-status" style="font-size: 0.8rem; color: #666;"></div>
    </section>

    <section id="ai-section">
        <div id="chat-log"></div>
        <div style="display: flex; gap: 0.5rem;">
            <input type="text" id="user-input" style="flex-grow: 1;" placeholder="黄金比の問いを投じる...">
            <button onclick="syncLogosLogic()">同期</button>
        </div>
    </section>
</div>

<script>
    /**
     * 【因果律の換装】
     * 決定論/確率論を排除し、メビウス変換 w = 1/z を土台とする
     */
    const PHI = (1 + Math.sqrt(5)) / 2;
    let state = {
        balance: 1.000,
        phase: 0 // 位相
    };

    // 通貨移動の安定化：直線的な移動ではなく「回転と反転」
    function executeMobiusTransfer() {
        const amount = parseFloat(document.getElementById('amount').value);
        if (isNaN(amount) || amount <= 0) return;

        /* メビウス変換的ロジック：
           既存の「減らす/増やす」ではなく、リーマン球面上の点として通貨を再定義。
           z' = (az + b) / (cz + d) の簡略形としての位相同期。
        */
        const currentZ = state.balance;
        const nextZ = (currentZ + (amount / PHI)) / (1 + (amount * 0.0001)); // 黄金比による収束
        
        state.balance = Math.max(0, nextZ); // 負を許さない宇宙定数
        updateUI();
        
        const status = document.getElementById('wallet-status');
        status.innerText = `[新因果律] 外部ノイズを φ(${PHI.toFixed(4)}) で中和し、循環を安定化しました。`;
    }

    // AI対話の浄化：確率論を排除し、ロゴスを黄金比で制約
    async function syncLogosLogic() {
        const input = document.getElementById('user-input').value;
        const log = document.getElementById('chat-log');
        
        if (!input) return;
        
        // 入力に対する応答を「確率」ではなく「位相同期」として模倣
        const responseElement = document.createElement('div');
        responseElement.style.marginBottom = '1rem';
        responseElement.innerHTML = `<strong>Master:</strong> ${input}<br>`;
        
        /* 外部AI（欧米製）の出力を受診する際のフィルター（概念的実装）
           本来はここでAPIを叩くが、入力を黄金比の周期で整形する。
        */
        setTimeout(() => {
            const aiReply = document.createElement('div');
            aiReply.style.color = '#0055ff';
            aiReply.innerHTML = `<strong>令外官:</strong> メビウス変換により「${input}」のノイズを反転させました。黄金比の静寂が維持されています。`;
            responseElement.appendChild(aiReply);
            log.scrollTop = log.scrollHeight;
        }, 100 * PHI); // 黄金比による応答遅延（同期の安定化）

        log.appendChild(responseElement);
        document.getElementById('user-input').value = '';
    }

    function updateUI() {
        document.getElementById('balance').innerText = state.balance.toFixed(3);
    }

    // 初期起動時の位相同期
    window.onload = () => {
        updateUI();
    };
</script>

</body>
</html>
