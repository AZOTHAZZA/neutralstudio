<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MSGAI - System Core V36.7</title>
<style>
/* STRUCTURAL DESIGN POLICY: 
  BASED ON HARMONIC CONSTANT (1.618)
  DO NOT REMOVE SUB-COMPONENTS 
*/
:root {
    --ratio: 1.6180339887;
    --accent: #007bff;
    --bg: #f0f2f5;
    --surface: #ffffff;
    --text: #1c1e21;
}

body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

/* HEADER & NAVIGATION */
header { background: #000; color: #fff; padding: 20px 0; flex-shrink: 0; border-bottom: 3px solid var(--accent); }
.brand { text-align: center; font-size: 1.25rem; font-weight: 800; letter-spacing: 0.2em; }
nav { display: flex; background: #1a1a1a; }
.tab-trigger { flex: 1; padding: 15px; border: none; background: none; color: #888; font-weight: bold; cursor: pointer; border-bottom: 3px solid transparent; transition: 0.2s; }
.tab-trigger.active { color: #fff; border-bottom-color: var(--accent); background: #222; }

/* VIEWPORT LAYOUT */
#main-viewport { flex-grow: 1; overflow-y: auto; padding: 20px; box-sizing: border-box; }
.pane { display: none; width: 100%; max-width: 800px; margin: 0 auto; }
.pane.active { display: block; }

/* COMPONENT: CARD */
.card { background: var(--surface); border-radius: 8px; border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
.card-title { font-size: 0.85rem; font-weight: 700; color: #606770; margin-bottom: 15px; text-transform: uppercase; border-left: 3px solid var(--accent); padding-left: 10px; }

/* COMPONENT: POLICY SELECTOR */
.policy-group { display: flex; gap: 4px; margin-bottom: 15px; background: #f0f2f5; padding: 4px; border-radius: 6px; width: fit-content; }
.policy-btn { padding: 6px 12px; font-size: 0.7rem; border: none; border-radius: 4px; cursor: pointer; background: none; color: #606770; font-weight: bold; }
.policy-btn.active { background: var(--surface); color: var(--accent); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

/* DATA VISUALIZATION */
.data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; }
.data-box { background: #f8f9fa; border: 1px solid #e9ecef; padding: 12px; border-radius: 6px; text-align: center; }
.data-label { font-size: 0.65rem; color: #90949c; margin-bottom: 5px; }
.data-value { font-family: "SFMono-Regular", Consolas, monospace; font-weight: bold; font-size: 1rem; }

/* INPUT & ACTION */
input, select { width: 100%; padding: 12px; border: 1px solid #ccd0d5; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box; font-size: 1rem; }
.action-btn { width: 100%; padding: 14px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; }
.btn-synthesis { background: #f02849; color: white; }
.btn-adjustment { background: var(--accent); color: white; }

/* TRACE SYSTEM (Logging) */
.trace-area { margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px; }
.trace-table { width: 100%; font-size: 0.7rem; border-collapse: collapse; }
.trace-table td { padding: 4px 0; border-bottom: 1px solid #f2f3f5; }
</style>
</head>
<body>

<header>
    <div class="brand">SYSTEM SOVEREIGN V36.7</div>
    <nav>
        <button class="tab-trigger active" onclick="switchPane('pane-asset')">ASSET</button>
        <button class="tab-trigger" onclick="switchPane('pane-transform')">TRANSFORM</button>
        <button class="tab-trigger" onclick="switchPane('pane-monitor')">MONITOR</button>
    </nav>
</header>

<main id="main-viewport">
    <section id="pane-asset" class="pane active">
        <div class="card">
            <div class="card-title">Balance Ledger</div>
            <div id="ledger-display" class="data-grid"></div>
        </div>

        <div class="card">
            <div class="card-title">Asset Synthesis</div>
            <div class="policy-group">
                <button class="policy-btn active" onclick="setPolicy('synthesis', 'manual')">MANUAL</button>
                <button class="policy-btn" onclick="setPolicy('synthesis', 'scheduled')">SCHEDULED</button>
                <button class="policy-btn" onclick="setPolicy('synthesis', 'ruled')">RULED</button>
            </div>
            <select id="syn-target"></select>
            <input type="number" id="syn-amount" value="100">
            <button class="action-btn btn-synthesis" onclick="runSynthesis()">EXECUTE SYNTHESIS</button>
            <div class="trace-area">
                <table class="trace-table" id="syn-trace"></table>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Corrective Adjustment</div>
            <input type="text" id="adj-destination" placeholder="Destination ID">
            <select id="adj-target"></select>
            <input type="number" id="adj-amount" value="10">
            <button class="action-btn btn-adjustment" onclick="runAdjustment()">EXECUTE ADJUSTMENT</button>
            <div class="trace-area">
                <table class="trace-table" id="adj-trace"></table>
            </div>
        </div>
    </section>

    <section id="pane-transform" class="pane">
        <div class="card" style="height: 60vh; display: flex; flex-direction: column;">
            <div class="card-title">Transform Engine (Analysis)</div>
            <div id="engine-out" style="flex-grow: 1; background: #1c1e21; color: #31a24c; padding: 15px; font-family: monospace; font-size: 0.8rem; overflow-y: auto; border-radius: 4px; margin-bottom: 10px;"></div>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="engine-in" placeholder="Input Data Sequence..." onkeydown="if(event.key==='Enter') runTransform()">
                <button class="action-btn btn-adjustment" style="width: 80px; padding: 0;" onclick="runTransform()">SEND</button>
            </div>
        </div>
    </section>

    <section id="pane-monitor" class="pane">
        <div class="card">
            <div class="card-title">Telemetrics</div>
            <div class="data-grid">
                <div class="data-box"><div class="data-label">Coefficient (z)</div><div class="data-value" id="z-val">0</div></div>
                <div class="data-box"><div class="data-label">Harmonic Ratio (w)</div><div class="data-value" id="w-val">0</div></div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">System Normalization</div>
            <button class="action-btn" style="background:#8a8d91; color:white; margin-bottom:8px;" onclick="resetSub('accounts')">PURGE LEDGER</button>
            <button class="action-btn" style="background:#8a8d91; color:white; margin-bottom:8px;" onclick="resetSub('hist')">PURGE HISTORY</button>
            <button class="action-btn" style="background:#1c1e21; color:white;" onclick="fullReset()">SYSTEM RE-INITIALIZATION</button>
        </div>
    </section>
</main>

<script>
/* INTERNAL CORE LOGIC: 
  DO NOT MODIFY TRANSFORMATION RATIOS 
*/
const ASSETS = ["USD","JPY","EUR","BTC","ETH","MATIC"];
const PHI = 1.6180339887;

const initStore = () => ({
    z: 0.05,
    accounts: { User_A: Object.fromEntries(ASSETS.map(a => [a, 0])), User_B: Object.fromEntries(ASSETS.map(a => [a, 0])) },
    hist: { mint: [], tx: [], ai: [] },
    policies: { synthesis: 'manual', data: 'user' }
});

let state = JSON.parse(localStorage.getItem('msgai_sov_v36_core')) || initStore();

const transformZ = (v) => typeof v === "string" ? (v.length/50) + (new Set(v).size/20) : v/100;
const transformW = (z) => PHI / (z || 0.000001);

function refresh() {
    const w = transformW(state.z);
    document.getElementById('z-val').textContent = state.z.toFixed(6);
    document.getElementById('w-val').textContent = w.toFixed(2);
    
    document.getElementById('ledger-display').innerHTML = ASSETS.map(a => `
        <div class="data-box"><div class="data-label">${a}</div><div class="data-value">${(state.accounts.User_A[a] || 0).toFixed(4)}</div></div>
    `).join('');

    ['mint', 'tx'].forEach(key => {
        const el = document.getElementById(key === 'mint' ? 'syn-trace' : 'adj-trace');
        if(el) el.innerHTML = state.hist[key].slice(-3).reverse().map(h => `
            <tr><td>${h.t}</td><td>${h.d}</td><td style="text-align:right">w:${h.w}</td></tr>
        `).join('');
    });

    localStorage.setItem('msgai_sov_v36_core', JSON.stringify(state));
}

function runSynthesis() {
    const asset = document.getElementById('syn-target').value;
    const amt = parseFloat(document.getElementById('syn-amount').value);
    const z = transformZ(asset + amt);
    const w = transformW(z);
    state.accounts.User_A[asset] += w;
    state.z += (z / 10);
    state.hist.mint.push({ t: new Date().toLocaleTimeString(), d: `SYN:${asset}`, w: w.toFixed(4) });
    refresh();
}

function runAdjustment() {
    const asset = document.getElementById('adj-target').value;
    const amt = parseFloat(document.getElementById('adj-amount').value);
    const dest = document.getElementById('adj-destination').value || "User_B";
    const z = transformZ(asset + amt);
    const w = transformW(z);
    if(state.accounts.User_A[asset] >= w) {
        state.accounts.User_A[asset] -= w;
        if(!state.accounts[dest]) state.accounts[dest] = Object.fromEntries(ASSETS.map(a => [a, 0]));
        state.accounts[dest][asset] += w;
        state.z += (z / 5);
        state.hist.tx.push({ t: new Date().toLocaleTimeString(), d: `ADJ:${dest}`, w: w.toFixed(4) });
        refresh();
    } else { alert("Operational Error: Insufficient Ratio"); }
}

function runTransform() {
    const input = document.getElementById('engine-in');
    const msg = input.value; if(!msg) return;
    const z = transformZ(msg);
    const w = transformW(z);
    const out = document.getElementById('engine-out');
    out.innerHTML += `<div>[INPUT] ${msg} <span style="color:#2d88ff">-> w:${w.toFixed(4)}</span></div>`;
    input.value = '';
    state.hist.ai.push({ t: new Date().toLocaleTimeString(), d: msg.substring(0, 15), w: w.toFixed(4) });
    state.z += z;
    refresh();
    out.scrollTop = out.scrollHeight;
}

function fullReset() { if(confirm("Confirm Full Reset?")) { state = initStore(); document.getElementById('engine-out').innerHTML = ""; refresh(); } }
function resetSub(p) { if(confirm(`Confirm Purge ${p}?`)) { state[p] = initStore()[p]; refresh(); } }

function switchPane(id) {
    document.querySelectorAll('.pane, .tab-trigger').forEach(el => el.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    event.target.classList.add('active');
}

function setPolicy(group, val) {
    state.policies[group] = val;
    document.querySelectorAll(`.policy-group button`).forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    refresh();
}

document.addEventListener('DOMContentLoaded', () => {
    ASSETS.forEach(a => {
        document.getElementById('syn-target').add(new Option(a, a));
        document.getElementById('adj-target').add(new Option(a, a));
    });
    refresh();
});
</script>
</body>
</html>
